syntax = "proto3";

package optiswift.proto.cinnamon;

option go_package = "./;proto";

import "google/protobuf/timestamp.proto";

enum TransferStatus {
  QUEUED = 0;
  PROCESSING = 1;
  SUCCESS = 2;
  FAILED = 3;
}

message BeneficiaryDetails {
  string account_id = 1;
  string account_name = 2;
  string institution_id = 3;
  string country = 4;
  string payment_method = 5;
}

message User {
  string id = 1;
  string first_name = 2;
  string last_name = 3;
  string middle_name = 4;
  string gender = 5;
  google.protobuf.Timestamp date_of_birth = 6;
  UserAddress postal_address = 7;
  UserIdDocument id_document = 8;
}

message UserAddress {
  string city = 1;
  string state = 2;
  string country = 3;
  string postal_code = 4;
  string street = 5;
}

message UserIdDocument {
  string type = 1;
  string number = 2;
  string issue_date = 3;
  string expiry_date = 4;
  string country = 5;
}

// General Transfer DTOs

message GeneralTransferRequest {
  string id = 1;
  double amount = 2;
  string base_currency = 3;
  string narration = 5;
  BeneficiaryDetails beneficiary_details = 7;
  string name_inquiry_reference = 8;
  map<string, string> extra_fields = 9;
  double rate = 10;
  User user_data = 11;
  optional bool should_queue = 12;
}

message GeneralTransferResponse {
  TransferStatus status = 1;
  string reference = 2;
  google.protobuf.Timestamp date = 3;
  float fee = 4;
  string provider_id = 5;
}

// Process Queue DTOs
message ProcessQueueRequest {
  optional string user_id = 1;
  optional string currency = 2;
}

message ProcessQueueResponse {
  int32 count = 1;
  string message = 2;
}

// Handle Callback DTOs
message HandleCallbackRequest {
  message Values {
    repeated string strings = 1;
  }
  string provider_id = 1;
  map<string, Values> headers = 2;
  map<string, Values> query = 3;
  optional bytes body = 4;
}

message HandleCallbackResponse {
  string transaction_id = 1;
  TransferStatus status = 2;
  optional string reason = 3;
}

message StreamTransferStatusRequest {
  string transaction_id = 1;
}

message CancelTransferRequest {
  string transaction_id = 1;
}

message CancelTransferResponse {
  string transaction_id = 1;
  string provider = 2;
  google.protobuf.Timestamp timestamp = 3;
  optional string message = 4;
}


message StreamTransferStatusResponse {
  string transaction_id = 1;
  string provider = 2;
  TransferStatus status = 3;
  google.protobuf.Timestamp timestamp = 4;
  optional string message = 5;
}


  service GeneralTransfer {
  rpc Transfer(GeneralTransferRequest) returns (GeneralTransferResponse);
  rpc ProcessQueue(ProcessQueueRequest) returns (ProcessQueueResponse);
  rpc HandleCallback(HandleCallbackRequest) returns (stream HandleCallbackResponse);
  rpc StreamTransferStatus(stream StreamTransferStatusRequest) returns (stream StreamTransferStatusResponse);
  rpc CancelTransfer(CancelTransferRequest) returns (StreamTransferStatusResponse);
}


}